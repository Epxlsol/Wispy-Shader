# Wispy Shaders V1.2 - Optimized
# Based on Mellow Shaders by TheCMK
# Performance optimizations by l_aggy
# Licensed under MIT

oldLighting=false
vignette=false
underwaterOverlay=false

#ifdef ROUND_SUN
sun=off
moon=off
#endif

#ifdef FANCY_CLOUDS
clouds=off
#endif

particles.ordering=mixed

texture.deferred.noisetex=/lib/cloud_noise+normal.png
texture.gbuffers.noisetex=/lib/cloud_noise+normal.png
texture.composite.colortex3=/lib/smaaArea.png
texture.composite.colortex5=/lib/smaaSearch.png

# ============================================
# OPTIMIZED BLOOM PIPELINE (4 passes instead of 6)
# ============================================
program.world0/composite2.enabled=BLOOM
program.world0/composite3.enabled=BLOOM
program.world0/composite4.enabled=BLOOM
# composite5 and composite6 DISABLED for performance
#program.world0/composite5.enabled=BLOOM
#program.world0/composite6.enabled=BLOOM
program.world0/composite7.enabled=BLOOM

program.world-1/composite2.enabled=BLOOM
program.world-1/composite3.enabled=BLOOM
program.world-1/composite4.enabled=BLOOM
#program.world-1/composite5.enabled=BLOOM
#program.world-1/composite6.enabled=BLOOM
program.world-1/composite7.enabled=BLOOM

program.world1/composite2.enabled=BLOOM
program.world1/composite3.enabled=BLOOM
program.world1/composite4.enabled=BLOOM
#program.world1/composite5.enabled=BLOOM
#program.world1/composite6.enabled=BLOOM
program.world1/composite7.enabled=BLOOM

# SMAA passes
program.world1/composite9.enabled=SMAA
program.world-1/composite9.enabled=SMAA
program.world0/composite9.enabled=SMAA
program.world1/composite10.enabled=SMAA
program.world-1/composite10.enabled=SMAA
program.world0/composite10.enabled=SMAA
program.world1/composite11.enabled=SMAA
program.world-1/composite11.enabled=SMAA
program.world0/composite11.enabled=SMAA

# DOF pass
program.world1/composite12.enabled=DOF
program.world-1/composite12.enabled=DOF
program.world0/composite12.enabled=DOF

# ============================================
# PERFORMANCE PROFILES - Choose one
# ============================================

# ULTRA PERFORMANCE - 150+ FPS (integrated graphics)
# All effects disabled except essentials
profile.ULTRA_PERFORMANCE = !BLOOM !FANCY_CLOUDS !WATER_NORMALS !SMAA REFLECTIONS=0 !GODRAYS !SSAO !DOF !MOTION_BLUR !FILM_GRAIN !VIGNETTE !AURORA_BOREALIS ATM_FOG_STRENGTH=0.5 !WAVY_PLANTS !BORDER_FOG TAA_MODE=0

# PERFORMANCE - 100-120 FPS (integrated graphics)
# Minimal effects for smooth gameplay
profile.PERFORMANCE = !BLOOM !FANCY_CLOUDS !WATER_NORMALS !SMAA REFLECTIONS=0 !GODRAYS !SSAO !DOF !MOTION_BLUR !FILM_GRAIN ATM_FOG_STRENGTH=0.75 TAA_MODE=0

# BALANCED - 60-80 FPS (integrated graphics / lower-end dedicated)
# Good balance of visuals and performance
profile.BALANCED = !BLOOM !FANCY_CLOUDS WATER_NORMALS !SMAA REFLECTIONS=1 !GODRAYS !SSAO !DOF !MOTION_BLUR ATM_FOG_STRENGTH=1.0 TAA_MODE=0

# QUALITY - 40-60 FPS (mid-range dedicated GPUs)
# Most features enabled
profile.QUALITY = BLOOM FANCY_CLOUDS WATER_NORMALS !SMAA REFLECTIONS=2 !GODRAYS !SSAO !DOF ATM_FOG_STRENGTH=1.0 TAA_MODE=2

# ULTRA QUALITY - 30-45 FPS (high-end dedicated GPUs)
# All features enabled
profile.ULTRA_QUALITY = BLOOM FANCY_CLOUDS WATER_NORMALS SMAA REFLECTIONS=3 GODRAYS SSAO DOF ATM_FOG_STRENGTH=1.0 TAA_MODE=3

# ============================================
# SETTINGS SCREENS - Reorganized & Simplified
# ============================================
screen = <profile> [LIGHTING] [ATMOSPHERE] [WATER] [POST] [TERRAIN] [INFO]

# --- Lighting & Colors ---
screen.LIGHTING = MIN_LIGHT_AMOUNT LM_FALLOFF_CURVE \
                  COLOR_SCHEME [LIGHT_COLORS] \
                  HANDHELD_FALLOFF_CURVE

screen.LIGHT_COLORS = LM_RED LM_GREEN LM_BLUE

# --- Atmosphere (Sky + Fog) ---
screen.ATMOSPHERE = [SKY] [FOG] sunPathRotation

screen.SKY = FANCY_CLOUDS CLOUD_OPACITY CLOUD_AMOUNT CLOUD_SPEED \
             AURORA_BOREALIS AURORA_STRENGTH AURORA_HEIGHT \
             STAR_SIZE STAR_STRENGTH \
             ROUND_SUN CUSTOM_SKYBOXES CUSTOM_SKYBOX_BRIGHTNESS

screen.FOG = ATMOSPHERIC_FOG ATM_FOG_STRENGTH BORDER_FOG \
             RAIN_SKY_DESATURATION RAIN_SKY_DARKENING

# --- Water ---
screen.WATER = REFLECTIONS SSR_STEPS WATER_TEXTURE_MODE \
               WATER_NORMALS WATER_NORMAL_STRENGTH WATER_NORMAL_SIZE \
               WATER_FOG_STRENGTH

# --- Post Processing ---
screen.POST = [COLOR_GRADING] [BLOOM_SETTINGS] [AA] [EFFECTS]

screen.COLOR_GRADING = EXPOSURE SATURATION VIBRANCE CONTRAST \
                       TONEMAP_OPERATOR TONEMAP_MIN_R TONEMAP_MIN_G TONEMAP_MIN_B

screen.BLOOM_SETTINGS = BLOOM BLOOM_STRENGTH BLOOM_CURVE

screen.AA = TAA_MODE TAA_BLEND_FACTOR TAA_OFFCENTER_REJECTION \
            SMAA SMAA_THRESHOLD SMAA_SEARCH_DISTANCE

screen.EFFECTS = SSAO SSAO_STRENGTH SSAO_SCALE \
                 GODRAYS GODRAYS_QUALITY \
                 DOF DOF_APERTURE_SIZE DOF_BLUR_QUALITY \
                 MOTION_BLUR MOTION_BLUR_STRENGTH \
                 IMAGE_SHARPENING SHARPENING \
                 FILM_GRAIN FILM_GRAIN_STRENGTH \
                 VIGNETTE_OPACITY VIGNETTE_FALLOFF

# --- Terrain ---
screen.TERRAIN = WAVY_PLANTS WAVE_AMPLITUDE WAVE_SPEED WAVE_SIZE WAVE_LEAVES \
                 RAIN_TILT_STRENGTH ENCHANT_GLINT_OPACITY \
                 DH_NOISE DH_CUTOFF DH_NOISE_SIZE

# --- Info ---
screen.INFO = [CREDITS] [PERFORMANCE_TIPS]

screen.CREDITS = * <empty> * Wispy Shaders V1 <empty> * <empty> * Based on Mellow Shaders <empty> * by TheCMK <empty> * <empty> * Optimizations by l_aggy <empty> *

screen.PERFORMANCE_TIPS = * <empty> * Performance Tips: <empty> * <empty> * Start with a profile <empty> * Disable Bloom: +10-15 FPS <empty> * Disable Fancy Clouds: +10-15 FPS <empty> * Disable Water Normals: +5-10 FPS <empty> * Lower SSR Steps: +5 FPS <empty> * Disable TAA: +3-5 FPS <empty> *

# ============================================
# SLIDERS
# ============================================
sliders = EXPOSURE SATURATION CONTRAST VIBRANCE \
          BLOOM_STRENGTH BLOOM_CURVE \
          CLOUD_OPACITY CLOUD_AMOUNT CLOUD_SPEED \
          STAR_SIZE STAR_STRENGTH \
          WAVE_AMPLITUDE WAVE_SPEED \
          MIN_LIGHT_AMOUNT ATM_FOG_STRENGTH \
          WATER_FOG_STRENGTH WATER_NORMAL_STRENGTH WATER_NORMAL_SIZE \
          SSR_STEPS GODRAYS_QUALITY \
          SSAO_STRENGTH SSAO_SCALE \
          MOTION_BLUR_STRENGTH FILM_GRAIN_STRENGTH \
          VIGNETTE_OPACITY VIGNETTE_FALLOFF \
          HANDHELD_FALLOFF_CURVE LM_FALLOFF_CURVE \
          SHARPENING SMAA_THRESHOLD \
          DOF_APERTURE_SIZE DOF_BLUR_QUALITY \
          sunPathRotation AURORA_STRENGTH AURORA_HEIGHT \
          LM_RED LM_GREEN LM_BLUE \
          TONEMAP_MIN_R TONEMAP_MIN_G TONEMAP_MIN_B

# ============================================
# CUSTOM UNIFORMS
# ============================================
uniform.float.timeAngle=worldTime/24000.0
variable.float.d=timeAngle-0.25
variable.float.e=0.5-cos(d*3.1415)/2.0
variable.float.timeThing=(d*2.0+e)/3.0
uniform.float.sunAngleAtHome=if(timeThing < 0.75, timeThing+0.25, timeThing-0.75)

uniform.float.nightStrength=min(abs(sin(timeAngle*2*pi))*2, 1)*floor(worldTime/12000)
uniform.float.dayStrength=min(abs(sin(timeAngle*2*pi))*2, 1)*(1-floor(worldTime/12000))
uniform.float.sunsetStrength=(1-nightStrength-dayStrength)*floor((worldTime/8000)%2)
uniform.float.sunriseStrength=(1-nightStrength-dayStrength)*(1-ceil(sunsetStrength))
uniform.vec2.resolution=vec2(viewWidth, viewHeight)
uniform.vec2.resolutionInv=vec2(1.0/viewWidth, 1.0/viewHeight)
variable.float.sunOrMoonPosx=if(sunAngleAtHome < 0.5, sunPosition.x, moonPosition.x)
variable.float.sunOrMoonPosy=if(sunAngleAtHome < 0.5, sunPosition.y, moonPosition.y)
variable.float.sunOrMoonPosz=if(sunAngleAtHome < 0.5, sunPosition.z, moonPosition.z)
variable.float.sunL=1/sqrt(sunPosition.x*sunPosition.x+sunPosition.y*sunPosition.y+sunPosition.z*sunPosition.z)
variable.float.sunOrMoonL=1/sqrt(sunOrMoonPosx*sunOrMoonPosx+sunOrMoonPosy*sunOrMoonPosy+sunOrMoonPosz*sunOrMoonPosz)
uniform.vec3.sunOrMoonPosN=vec3(sunOrMoonPosx*sunOrMoonL, sunOrMoonPosy*sunOrMoonL, sunOrMoonPosz*sunOrMoonL)
uniform.vec3.sunPosN=vec3(sunPosition.x*sunL, sunPosition.y*sunL, sunPosition.z*sunL)
uniform.float.isOutdoorsSmooth=smooth(if(eyeBrightness.y > 50, 1, 0), 10, 10)
uniform.float.precipitationSmooth=smooth(biome_precipitation, 150, 150)
uniform.float.fogAmount=(0.5 + sunriseStrength + nightStrength + smooth(if(biome == BIOME_PALE_GARDEN && nightStrength > 0.99, 50, temperature), 10, 10) + rainStrength + thunderStrength) * isOutdoorsSmooth * ATM_FOG_STRENGTH

alphaTest.gbuffers_skybasic=false
alphaTest.gbuffers_skytextured=false
alphaTest.gbuffers_clouds=GREATER 0.005

dhShadow.enabled=false

blend.composite5=ONE ONE ONE ONE
blend.composite6=ONE ONE ONE ONE
