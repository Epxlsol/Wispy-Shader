# Wispy Shaders V1.3
# Based on Mellow Shaders by TheCMK (https://modrinth.com/shader/mellow)
# Performance optimizations by l_aggy
# Licensed under MIT

# ===== CORE SETTINGS =====
oldLighting=false
vignette=false
underwaterOverlay=false

#ifdef ROUND_SUN
sun=off
moon=off
#endif

option.FANCY_CLOUDS=false

particles.ordering=mixed

# ===== TEXTURE BINDINGS =====
texture.deferred.noisetex=/lib/cloud_noise+normal.png
texture.gbuffers.noisetex=/lib/cloud_noise+normal.png

# ===== PERFORMANCE PROFILES =====
profile.ULTRA_PERFORMANCE = WATER_RED=0.25 WATER_GREEN=0.25 WATER_BLUE=0.25 BIOME_SKY_CONTRIBUTION=0.5 !BLOOM !FANCY_CLOUDS !WATER_NORMALS !GODRAYS !SSAO !MOTION_BLUR !FILM_GRAIN !VIGNETTE !AURORA_BOREALIS ATM_FOG_STRENGTH=0.5 !WAVY_PLANTS !BORDER_FOG TAA_MODE=0 EXPOSURE=1.1 SATURATION=1.0 FILM_GRAIN_STRENGTH=0.0 VIGNETTE_FALLOFF=0.0

profile.PERFORMANCE = WATER_RED=0.25 WATER_GREEN=0.25 WATER_BLUE=0.25 BIOME_SKY_CONTRIBUTION=0.5 !BLOOM !FANCY_CLOUDS !WATER_NORMALS !GODRAYS !SSAO !MOTION_BLUR !FILM_GRAIN !VIGNETTE ATM_FOG_STRENGTH=0.75 TAA_MODE=0 EXPOSURE=1.1 SATURATION=1.1 FILM_GRAIN_STRENGTH=0.0 VIGNETTE_FALLOFF=0.0

profile.BALANCED = WATER_RED=0.25 WATER_GREEN=0.25 WATER_BLUE=0.25 BIOME_SKY_CONTRIBUTION=0.5 !BLOOM !FANCY_CLOUDS WATER_NORMALS !GODRAYS !SSAO !MOTION_BLUR !FILM_GRAIN VIGNETTE ATM_FOG_STRENGTH=1.0 TAA_MODE=0 EXPOSURE=1.1 SATURATION=1.1 FILM_GRAIN_STRENGTH=0.0 VIGNETTE_FALLOFF=0.4

profile.QUALITY = WATER_RED=0.25 WATER_GREEN=0.25 WATER_BLUE=0.25 BIOME_SKY_CONTRIBUTION=0.5 BLOOM FANCY_CLOUDS WATER_NORMALS !GODRAYS !SSAO !MOTION_BLUR FILM_GRAIN VIGNETTE ATM_FOG_STRENGTH=1.0 TAA_MODE=2 EXPOSURE=1.2 SATURATION=1.2 FILM_GRAIN_STRENGTH=0.2 VIGNETTE_FALLOFF=0.5

profile.ULTRA_QUALITY = WATER_RED=0.25 WATER_GREEN=0.25 WATER_BLUE=0.25 BIOME_SKY_CONTRIBUTION=0.5 BLOOM FANCY_CLOUDS WATER_NORMALS GODRAYS SSAO MOTION_BLUR FILM_GRAIN VIGNETTE ATM_FOG_STRENGTH=1.0 TAA_MODE=3 EXPOSURE=1.2 SATURATION=1.3 FILM_GRAIN_STRENGTH=0.3 VIGNETTE_FALLOFF=0.6

# ===== PROGRAM TOGGLES =====
program.composite.enabled=GODRAYS

program.world0/composite2.enabled=BLOOM
program.world0/composite3.enabled=BLOOM
program.world0/composite4.enabled=BLOOM
program.world0/composite5.enabled=BLOOM
program.world0/composite6.enabled=BLOOM
program.world0/composite7.enabled=BLOOM
program.world-1/composite2.enabled=BLOOM
program.world-1/composite3.enabled=BLOOM
program.world-1/composite4.enabled=BLOOM
program.world-1/composite5.enabled=BLOOM
program.world-1/composite6.enabled=BLOOM
program.world-1/composite7.enabled=BLOOM
program.world1/composite2.enabled=BLOOM
program.world1/composite3.enabled=BLOOM
program.world1/composite4.enabled=BLOOM
program.world1/composite5.enabled=BLOOM
program.world1/composite6.enabled=BLOOM
program.world1/composite7.enabled=BLOOM

# Alpha test settings
alphaTest.gbuffers_skybasic=false
alphaTest.gbuffers_skytextured=false
alphaTest.gbuffers_clouds=GREATER 0.005

# Blend modes
blend.composite5=ONE ONE ONE ONE
blend.composite6=ONE ONE ONE ONE

# Shadow settings
dhShadow.enabled=false

# ===== MAIN MENU STRUCTURE =====
screen = <profile> [ENVIRONMENT] [ATMOSPHERE] [LIGHTING] [VISUAL_QUALITY] [POST_PROCESSING] [ADVANCED] [INFO]

# Alpha test settings
alphaTest.gbuffers_skybasic=false
alphaTest.gbuffers_skytextured=false
alphaTest.gbuffers_clouds=GREATER 0.005

# Blend modes
blend.composite5=ONE ONE ONE ONE
blend.composite6=ONE ONE ONE ONE

# Shadow settings
dhShadow.enabled=false

# ===== MAIN MENU STRUCTURE =====
screen = <profile> [ENVIRONMENT] [ATMOSPHERE] [LIGHTING] [VISUAL_QUALITY] [POST_PROCESSING] [ADVANCED] [INFO]

# ===== OPTION DECLARATIONS (Required for Menu) =====
option.MOTION_BLUR=false
option.VIGNETTE=false
option.FILM_GRAIN=false
option.EXPOSURE=1.1
option.SATURATION=1.1
option.CONTRAST=1.0
option.VIBRANCE=1.0
option.SHARPENING=0.0
option.FILM_GRAIN_STRENGTH=0.2
option.VIGNETTE_FALLOFF=0.5
option.MOTION_BLUR_STRENGTH=1.0

# ===== ENVIRONMENT =====
screen.ENVIRONMENT = [WATER_COLOR_SETTINGS] [WATER_WAVE_SETTINGS] [TERRAIN_ANIMATION] REFLECTIONS SSR_STEPS REFLECT_SUN WATER_NORMALS WATER_TEXTURE_MODE
screen.WATER_COLOR_SETTINGS = WATER_RED WATER_GREEN WATER_BLUE WATER_ALPHA BIOME_SKY_CONTRIBUTION WATER_FOG_STRENGTH BIOME_WATER_CONTRIBUTION
screen.WATER_WAVE_SETTINGS = WATER_NORMAL_STRENGTH WATER_NORMAL_SIZE WATER_NORMAL_SPEED
screen.TERRAIN_ANIMATION = WAVY_PLANTS WAVE_AMPLITUDE WAVE_SPEED WAVE_SIZE WAVE_LEAVES

# ===== ATMOSPHERE =====
screen.ATMOSPHERE = [FOG] [SKY] [CLOUDS] [WEATHER_EFFECTS] [CUSTOM_SKY] [CELESTIAL]
screen.FOG = ATMOSPHERIC_FOG ATM_FOG_STRENGTH BORDER_FOG GODRAYS GODRAYS_QUALITY
screen.SKY = STAR_SIZE STAR_STRENGTH AURORA_BOREALIS AURORA_STRENGTH AURORA_HEIGHT AURORA_EVERYWHERE
screen.CLOUDS = FANCY_CLOUDS CLOUD_OPACITY CLOUD_AMOUNT CLOUD_SPEED CLOUD_QUALITY
screen.WEATHER_EFFECTS = RAIN_TILT_STRENGTH RAIN_SKY_DESATURATION RAIN_SKY_DARKENING
screen.CUSTOM_SKY = CUSTOM_SKYBOXES CUSTOM_SKYBOX_BRIGHTNESS
screen.CELESTIAL = ROUND_SUN sunPathRotation MOON_PHASE_INFLUENCE

# ===== LIGHTING =====
screen.LIGHTING = MIN_LIGHT_AMOUNT LM_FALLOFF_CURVE HANDHELD_LIGHTS [AMBIENT_STRENGTH]
screen.AMBIENT_STRENGTH = SUNRISE_AMBIENT NOON_AMBIENT SUNSET_AMBIENT NIGHT_AMBIENT

# ===== VISUAL QUALITY =====
screen.VISUAL_QUALITY = BLOOM SSAO [BLOOM_SETTINGS] [SSAO_SETTINGS]
screen.BLOOM_SETTINGS = BLOOM_STRENGTH BLOOM_CURVE
screen.SSAO_SETTINGS = SSAO_STRENGTH SSAO_SCALE

# ===== POST PROCESSING =====
screen.POST_PROCESSING = [ANTI_ALIASING] [COLOR_GRADING] [CAMERA_EFFECTS] [SHARPENING]
screen.ANTI_ALIASING = TAA_MODE TAA_BLEND_FACTOR
screen.COLOR_GRADING = EXPOSURE SATURATION VIBRANCE CONTRAST TONEMAP_OPERATOR
screen.CAMERA_EFFECTS = MOTION_BLUR MOTION_BLUR_STRENGTH FILM_GRAIN FILM_GRAIN_STRENGTH VIGNETTE VIGNETTE_FALLOFF
screen.SHARPENING = SHARPENING

# ===== ADVANCED =====
screen.ADVANCED = [DISTANT_HORIZONS] [DEBUG]
screen.DISTANT_HORIZONS = DH_NOISE DH_CUTOFF DH_NOISE_SIZE
screen.DEBUG = DEBUG_SHOW_BUFFER

# ===== SLIDER DEFINITIONS =====
sliders = EXPOSURE SATURATION CONTRAST VIBRANCE SHARPENING \
          FILM_GRAIN_STRENGTH VIGNETTE_FALLOFF MOTION_BLUR_STRENGTH \
          BLOOM_STRENGTH BLOOM_CURVE \
          CLOUD_OPACITY CLOUD_AMOUNT CLOUD_SPEED CLOUD_QUALITY \
          STAR_SIZE STAR_STRENGTH \
          WAVE_AMPLITUDE WAVE_SPEED WAVE_SIZE \
          MIN_LIGHT_AMOUNT ATM_FOG_STRENGTH \
          WATER_FOG_STRENGTH WATER_NORMAL_STRENGTH WATER_NORMAL_SIZE WATER_NORMAL_SPEED \
          SSR_STEPS GODRAYS_QUALITY \
          SSAO_STRENGTH SSAO_SCALE \
          HANDHELD_FALLOFF_CURVE LM_FALLOFF_CURVE sunPathRotation \
          SUNRISE_AMBIENT NOON_AMBIENT SUNSET_AMBIENT NIGHT_AMBIENT \
          WATER_RED WATER_GREEN WATER_BLUE WATER_ALPHA \
          BIOME_WATER_CONTRIBUTION BIOME_SKY_CONTRIBUTION \
          RAIN_TILT_STRENGTH RAIN_SKY_DESATURATION RAIN_SKY_DARKENING \
          TAA_BLEND_FACTOR TAA_OFFCENTER_REJECTION \
          DH_CUTOFF DH_NOISE_SIZE \
          LM_FLICKER_STRENGTH ENCHANT_GLINT_OPACITY \
          CUSTOM_SKYBOX_BRIGHTNESS

# ===== CUSTOM UNIFORMS =====
uniform.float.timeAngle=worldTime/24000.0
variable.float.d=timeAngle-0.25
variable.float.e=0.5-cos(d*3.1415)/2.0
variable.float.timeThing=(d*2.0+e)/3.0
uniform.float.sunAngleAtHome=if(timeThing < 0.75, timeThing+0.25, timeThing-0.75)

uniform.float.nightStrength=min(abs(sin(timeAngle*2*pi))*2, 1)*floor(worldTime/12000)
uniform.float.dayStrength=min(abs(sin(timeAngle*2*pi))*2, 1)*(1-floor(worldTime/12000))
uniform.float.sunsetStrength=(1-nightStrength-dayStrength)*floor((worldTime/8000)%2)
uniform.float.sunriseStrength=(1-nightStrength-dayStrength)*(1-ceil(sunsetStrength))

uniform.vec2.resolution=vec2(viewWidth, viewHeight)
uniform.vec2.resolutionInv=vec2(1.0/viewWidth, 1.0/viewHeight)

variable.float.sunOrMoonPosx=if(sunAngleAtHome < 0.5, sunPosition.x, moonPosition.x)
variable.float.sunOrMoonPosy=if(sunAngleAtHome < 0.5, sunPosition.y, moonPosition.y)
variable.float.sunOrMoonPosz=if(sunAngleAtHome < 0.5, sunPosition.z, moonPosition.z)
variable.float.sunL=1/sqrt(sunPosition.x*sunPosition.x+sunPosition.y*sunPosition.y+sunPosition.z*sunPosition.z)
variable.float.sunOrMoonL=1/sqrt(sunOrMoonPosx*sunOrMoonPosx+sunOrMoonPosy*sunOrMoonPosy+sunOrMoonPosz*sunOrMoonPosz)

uniform.vec3.sunOrMoonPosN=vec3(sunOrMoonPosx*sunOrMoonL, sunOrMoonPosy*sunOrMoonL, sunOrMoonPosz*sunOrMoonL)
uniform.vec3.sunPosN=vec3(sunPosition.x*sunL, sunPosition.y*sunL, sunPosition.z*sunL)

uniform.float.isOutdoorsSmooth=smooth(if(eyeBrightness.y > 50, 1, 0), 10, 10)
uniform.float.precipitationSmooth=smooth(biome_precipitation, 150, 150)
uniform.float.fogAmount=(0.5 + sunriseStrength + nightStrength + smooth(if(biome == BIOME_PALE_GARDEN && nightStrength > 0.99, 50, temperature), 10, 10) + rainStrength + thunderStrength) * isOutdoorsSmooth * ATM_FOG_STRENGTH

option.SSAO=true
