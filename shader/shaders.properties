# Wispy Shaders V1.3
# Based on Mellow Shaders by TheCMK
# Performance optimizations by l_aggy

oldLighting=false
vignette=false
underwaterOverlay=false

#ifdef ROUND_SUN
sun=off
moon=off
#endif

#ifdef FANCY_CLOUDS
clouds=off
#endif

particles.ordering=mixed

texture.deferred.noisetex=/lib/cloud_noise+normal.png
texture.gbuffers.noisetex=/lib/cloud_noise+normal.png

# ===== PERFORMANCE PROFILES =====
profile.ULTRA_PERFORMANCE = !BLOOM !FANCY_CLOUDS !SSAO !MOTION_BLUR !FILM_GRAIN !BORDER_FOG !WAVY_PLANTS ATM_FOG_STRENGTH=0.25 TAA_MODE=0
profile.PERFORMANCE = !BLOOM !FANCY_CLOUDS !SSAO !MOTION_BLUR !WAVY_PLANTS ATM_FOG_STRENGTH=0.5 TAA_MODE=0
profile.BALANCED = !BLOOM FANCY_CLOUDS !SSAO WAVY_PLANTS ATM_FOG_STRENGTH=0.5 TAA_MODE=0
profile.QUALITY = BLOOM FANCY_CLOUDS !SSAO WAVY_PLANTS ATM_FOG_STRENGTH=0.5 TAA_MODE=2
profile.ULTRA_QUALITY = BLOOM FANCY_CLOUDS !SSAO WAVY_PLANTS ATM_FOG_STRENGTH=0.6 TAA_MODE=2

# ===== PROGRAM TOGGLES =====
# (Keeping existing bloom program toggles)
program.world0/composite2.enabled=BLOOM
program.world0/composite3.enabled=BLOOM
program.world0/composite4.enabled=BLOOM
program.world0/composite5.enabled=BLOOM
program.world0/composite6.enabled=BLOOM
program.world0/composite7.enabled=BLOOM
program.world-1/composite2.enabled=BLOOM
program.world-1/composite3.enabled=BLOOM
program.world-1/composite4.enabled=BLOOM
program.world-1/composite5.enabled=BLOOM
program.world-1/composite6.enabled=BLOOM
program.world-1/composite7.enabled=BLOOM
program.world1/composite2.enabled=BLOOM
program.world1/composite3.enabled=BLOOM
program.world1/composite4.enabled=BLOOM
program.world1/composite5.enabled=BLOOM
program.world1/composite6.enabled=BLOOM
program.world1/composite7.enabled=BLOOM

alphaTest.gbuffers_skybasic=false
alphaTest.gbuffers_skytextured=false
alphaTest.gbuffers_clouds=GREATER 0.005

blend.composite5=ONE ONE ONE ONE
blend.composite6=ONE ONE ONE ONE

dhShadow.enabled=false

# ===== MENU STRUCTURE =====
screen = <profile> [ENVIRONMENT] [ATMOSPHERE] [LIGHTING] [VISUAL_QUALITY] [POST_PROCESSING] [ADVANCED] [INFO]

screen.ENVIRONMENT = WATER_TEXTURE_MODE WATER_FOG_STRENGTH [TERRAIN_ANIMATION]
screen.TERRAIN_ANIMATION = WAVY_PLANTS WAVE_AMPLITUDE WAVE_SPEED WAVE_SIZE WAVE_LEAVES
screen.ATMOSPHERE = [FOG] [SKY] [CLOUDS] [WEATHER_EFFECTS] [CELESTIAL]
screen.FOG = ATMOSPHERIC_FOG ATM_FOG_STRENGTH BORDER_FOG
screen.SKY = STAR_SIZE STAR_STRENGTH
screen.CLOUDS = FANCY_CLOUDS CLOUD_OPACITY CLOUD_AMOUNT CLOUD_HEIGHT CLOUD_SPEED CLOUD_QUALITY
screen.WEATHER_EFFECTS = RAIN_SKY_DESATURATION RAIN_SKY_DARKENING
screen.CELESTIAL = ROUND_SUN sunPathRotation MOON_PHASE_INFLUENCE

screen.LIGHTING = MIN_LIGHT_AMOUNT LM_FALLOFF_CURVE [AMBIENT_STRENGTH]
screen.AMBIENT_STRENGTH = SUNRISE_AMBIENT NOON_AMBIENT SUNSET_AMBIENT NIGHT_AMBIENT

screen.VISUAL_QUALITY = BLOOM SSAO [BLOOM_SETTINGS] [SSAO_SETTINGS]
screen.BLOOM_SETTINGS = BLOOM_STRENGTH BLOOM_CURVE
screen.SSAO_SETTINGS = SSAO_STRENGTH SSAO_SCALE

screen.POST_PROCESSING = VIGNETTE VIGNETTE_STRENGTH [ANTI_ALIASING] [COLOR_GRADING] [CAMERA_EFFECTS] [SHARPENING]
screen.ANTI_ALIASING = TAA_MODE TAA_BLEND_FACTOR TAA_OFFCENTER_REJECTION
screen.COLOR_GRADING = EXPOSURE SATURATION VIBRANCE CONTRAST TONEMAP_OPERATOR
screen.CAMERA_EFFECTS = MOTION_BLUR MOTION_BLUR_STRENGTH FILM_GRAIN FILM_GRAIN_STRENGTH
screen.SHARPENING = IMAGE_SHARPENING SHARPENING

screen.ADVANCED = [DISTANT_HORIZONS] [DEBUG]
screen.DISTANT_HORIZONS = DH_NOISE DH_CUTOFF DH_NOISE_SIZE
screen.DEBUG = DEBUG_SHOW_BUFFER

# ===== SLIDERS LIST =====
sliders = COLOR_PRESET EXPOSURE SATURATION CONTRAST VIBRANCE CAS_STRENGTH \
          BLOOM_STRENGTH BLOOM_CURVE CLOUD_OPACITY CLOUD_AMOUNT CLOUD_HEIGHT CLOUD_SPEED CLOUD_QUALITY \
          STAR_SIZE STAR_TWINKLE STAR_STRENGTH MIN_LIGHT_AMOUNT ATM_FOG_STRENGTH FOG_PULSE WATER_FOG_STRENGTH WATER_RIPPLES \
          WAVE_AMPLITUDE WAVE_SPEED WAVE_SIZE \
          SSAO_STRENGTH SSAO_SCALE SUN_GLARE_VARIATION MOTION_BLUR_STRENGTH FILM_GRAIN_STRENGTH \
          HANDHELD_FALLOFF_CURVE LM_FALLOFF_CURVE sunPathRotation \
          SUNRISE_AMBIENT NOON_AMBIENT SUNSET_AMBIENT NIGHT_AMBIENT \
          RAIN_SKY_DESATURATION RAIN_SKY_DARKENING TAA_BLEND_FACTOR TAA_OFFCENTER_REJECTION \
          DH_CUTOFF DH_NOISE_SIZE ENCHANT_GLINT_OPACITY CUSTOM_SKYBOX_BRIGHTNESS \
          VIGNETTE_STRENGTH

# ===== SLIDER DEFINITIONS =====
slider.CLOUD_HEIGHT = 50.0 600.0 10.0
slider.VIGNETTE_STRENGTH = 0.0 1.0 0.05
slider.CAS_STRENGTH = 0.0 1.0 0.05

uniform.float.timeAngle=worldTime/24000.0
variable.float.d=timeAngle-0.25
variable.float.e=0.5-cos(d*3.1415)/2.0
variable.float.timeThing=(d*2.0+e)/3.0
uniform.float.sunAngleAtHome=if(timeThing < 0.75, timeThing+0.25, timeThing-0.75)

uniform.float.nightStrength=min(abs(sin(timeAngle*2*pi))*2, 1)*floor(worldTime/12000)
uniform.float.dayStrength=min(abs(sin(timeAngle*2*pi))*2, 1)*(1-floor(worldTime/12000))
uniform.float.sunsetStrength=(1-nightStrength-dayStrength)*floor((worldTime/8000)%2)
uniform.float.sunriseStrength=(1-nightStrength-dayStrength)*(1-ceil(sunsetStrength))

uniform.vec2.resolution=vec2(viewWidth, viewHeight)
uniform.vec2.resolutionInv=vec2(1.0/viewWidth, 1.0/viewHeight)

variable.float.sunOrMoonPosx=if(sunAngleAtHome < 0.5, sunPosition.x, moonPosition.x)
variable.float.sunOrMoonPosy=if(sunAngleAtHome < 0.5, sunPosition.y, moonPosition.y)
variable.float.sunOrMoonPosz=if(sunAngleAtHome < 0.5, sunPosition.z, moonPosition.z)
variable.float.sunL=1/sqrt(sunPosition.x*sunPosition.x+sunPosition.y*sunPosition.y+sunPosition.z*sunPosition.z)
variable.float.sunOrMoonL=1/sqrt(sunOrMoonPosx*sunOrMoonPosx+sunOrMoonPosy*sunOrMoonPosy+sunOrMoonPosz*sunOrMoonPosz)

uniform.vec3.sunOrMoonPosN=vec3(sunOrMoonPosx*sunOrMoonL, sunOrMoonPosy*sunOrMoonL, sunOrMoonPosz*sunOrMoonL)
uniform.vec3.sunPosN=vec3(sunPosition.x*sunL, sunPosition.y*sunL, sunPosition.z*sunL)

uniform.float.isOutdoorsSmooth=smooth(if(eyeBrightness.y > 50, 1, 0), 10, 10)
uniform.float.precipitationSmooth=smooth(biome_precipitation, 150, 150)
uniform.float.fogAmount=(0.5 + sunriseStrength + nightStrength + smooth(if(biome == BIOME_PALE_GARDEN && nightStrength > 0.99, 50, temperature), 10, 10) + rainStrength + thunderStrength) * isOutdoorsSmooth * ATM_FOG_STRENGTH

option.SSAO=true
option.VIGNETTE=VIGNETTE
